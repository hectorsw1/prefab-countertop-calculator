<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stone Prefab Calculator</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState } = React;

    function StoneCalculator() {
      const [materialType, setMaterialType] = useState('Granite');
      const [stoneColor, setStoneColor] = useState('Luna Grey');
      const [edgeType, setEdgeType] = useState('Basic Edge ($14/sq ft)');
      const [kitchenSinkType, setKitchenSinkType] = useState('No Kitchen Sink ($0)');
      const [kitchenSinkQty, setKitchenSinkQty] = useState(0);
      const [bathroomSinkQty, setBathroomSinkQty] = useState(0);
      const [sections, setSections] = useState([
        { name: 'sink', length: 99, width: 26, type: 'Countertop', jointStatus: 'Jointed', group: 'A' },
        { name: 'L to sink', length: 80, width: 26, type: 'Countertop', jointStatus: 'Jointed', group: 'A' },
        { name: 'L Stove', length: 60, width: 26, type: 'Countertop', jointStatus: 'Standalone', group: '' },
        { name: 'R Stove', length: 37, width: 26, type: 'Countertop', jointStatus: 'Standalone', group: '' },
        { name: 'Bar', length: 71, width: 14, type: 'Bartop', jointStatus: 'Standalone', group: '' },
        { name: 'Section F', length: 99, width: 4, type: '4" Backsplash', jointStatus: 'Standalone', group: '' },
        { name: 'Section G', length: 24, width: 4, type: '4" Backsplash', jointStatus: 'Standalone', group: '' },
        { name: 'Section H', length: 80, width: 4, type: '4" Backsplash', jointStatus: 'Standalone', group: '' },
        { name: 'Section I', length: 24, width: 4, type: '4" Backsplash', jointStatus: 'Standalone', group: '' },
        { name: 'Section J', length: 60, width: 4, type: '4" Backsplash', jointStatus: 'Standalone', group: '' },
        { name: 'Section K', length: 37, width: 4, type: '4" Backsplash', jointStatus: 'Standalone', group: '' }
      ]);
      
      const [newSection, setNewSection] = useState({
        name: '',
        length: '',
        width: '',
        type: '4" Backsplash',
        jointStatus: 'Standalone',
        group: ''
      });

      const [calculatedResults, setCalculatedResults] = useState(null);
      const [customerSinks, setCustomerSinks] = useState(0);
      const [oversizeFee, setOversizeFee] = useState(0);
      const [addedFab, setAddedFab] = useState(0);

      const availableStones = [
        { length: 108, width: 26 },
        { length: 108, width: 14 },
        { length: 108, width: 4 },
        { length: 96, width: 26 },
        { length: 96, width: 14 }
      ];

      const optimizeStoneLayout = (sections, materialType) => {
        const isNaturalStone = ['Granite', 'Marble', 'Quartzite'].includes(materialType);
        const stonesUsed = [];
        
        const groups = {};
        const standalone = [];
        
        sections.forEach(section => {
          if (isNaturalStone && section.jointStatus === 'Jointed' && section.group) {
            if (!groups[section.group]) {
              groups[section.group] = [];
            }
            groups[section.group].push(section);
          } else {
            standalone.push(section);
          }
        });
        
        Object.keys(groups).forEach(groupKey => {
          const groupSections = groups[groupKey];
          const width = groupSections[0].width;
          const totalLength = groupSections.reduce((sum, s) => sum + s.length, 0);
          
          const suitableStones = availableStones
            .filter(stone => stone.width === width)
            .sort((a, b) => b.length - a.length);
          
          if (suitableStones.length > 0) {
            const stoneSize = suitableStones[0];
            const numStones = Math.ceil(totalLength / stoneSize.length);
            
            let remainingLength = totalLength;
            for (let i = 0; i < numStones; i++) {
              const usedLength = Math.min(stoneSize.length, remainingLength);
              const leftoverLength = stoneSize.length - usedLength;
              
              stonesUsed.push({
                size: `${stoneSize.length}×${stoneSize.width}`,
                usedFor: groupSections.map(s => s.name).join(', '),
                leftover: `${leftoverLength}×${stoneSize.width}`,
                leftoverSqFt: (leftoverLength * stoneSize.width) / 144
              });
              
              remainingLength -= usedLength;
            }
          }
        });
        
        const byWidth = {};
        standalone.forEach(section => {
          if (!byWidth[section.width]) {
            byWidth[section.width] = [];
          }
          byWidth[section.width].push(section);
        });
        
        Object.keys(byWidth).sort((a, b) => b - a).forEach(width => {
          const sectionsAtWidth = byWidth[width].sort((a, b) => b.length - a.length);
          
          const suitableStones = availableStones
            .filter(stone => stone.width === parseInt(width))
            .sort((a, b) => b.length - a.length);
          
          if (suitableStones.length === 0) return;
          
          const stoneSize = suitableStones[0];
          
          while (sectionsAtWidth.length > 0) {
            let currentLength = 0;
            const packedSections = [];
            
            for (let i = 0; i < sectionsAtWidth.length; i++) {
              if (currentLength + sectionsAtWidth[i].length <= stoneSize.length) {
                currentLength += sectionsAtWidth[i].length;
                packedSections.push(sectionsAtWidth[i].name);
                sectionsAtWidth.splice(i, 1);
                i--;
              }
            }
            
            const leftoverLength = stoneSize.length - currentLength;
            
            stonesUsed.push({
              size: `${stoneSize.length}×${stoneSize.width}`,
              usedFor: packedSections.join(', '),
              leftover: `${leftoverLength}×${stoneSize.width}`,
              leftoverSqFt: (leftoverLength * stoneSize.width) / 144
            });
          }
        });
        
        return stonesUsed;
      };

      const calculatePlywoodSheets = (sections) => {
        const needsPlywood = sections.filter(s => 
          s.type === 'Countertop' || s.type === 'Bartop'
        );
        
        const totalSqFt = needsPlywood.reduce((sum, s) => 
          sum + (s.length * s.width) / 144, 0
        );
        
        const sheetCapacity = (96 * 48) / 144;
        const sheetsNeeded = Math.ceil(totalSqFt / sheetCapacity);
        
        return {
          count: sheetsNeeded,
          totalSqFt: totalSqFt,
          cost: sheetsNeeded * 70
        };
      };

      const calculateResults = () => {
        const stoneOptimization = optimizeStoneLayout(sections, materialType);
        const plywoodCalc = calculatePlywoodSheets(sections);
        
        const stoneCounts = {};
        stoneOptimization.forEach(stone => {
          stoneCounts[stone.size] = (stoneCounts[stone.size] || 0) + 1;
        });
        
        const totalStoneSqFt = stoneOptimization.reduce((sum, stone) => {
          const [length, width] = stone.size.split('×').map(Number);
          return sum + (length * width) / 144;
        }, 0);
        
        const totalWasteSqFt = stoneOptimization.reduce((sum, stone) => 
          sum + stone.leftoverSqFt, 0
        );
        
        const edgePrice = parseFloat(edgeType.match(/\$(\d+)/)[1]);
        const roundedSqFt = Math.ceil(totalStoneSqFt - totalWasteSqFt);
        const edgeCost = roundedSqFt * edgePrice;
        
        const kitchenSinkMatch = kitchenSinkType.match(/\$(\d+)/);
        const kitchenSinkPrice = kitchenSinkMatch ? parseFloat(kitchenSinkMatch[1]) : 0;
        const kitchenSinkCost = kitchenSinkQty * kitchenSinkPrice;
        
        const bathroomSinkCost = bathroomSinkQty * 80;
        
        const subtotal = edgeCost + kitchenSinkCost + bathroomSinkCost + plywoodCalc.cost;
        
        const adjustments = parseFloat(customerSinks) + parseFloat(oversizeFee) + parseFloat(addedFab);
        const projectTotal = subtotal + adjustments;
        
        setCalculatedResults({
          stoneOptimization,
          stoneCounts,
          totalStoneSqFt,
          totalWasteSqFt,
          roundedSqFt,
          edgeCost,
          kitchenSinkCost,
          bathroomSinkCost,
          plywoodCalc,
          subtotal,
          adjustments,
          projectTotal
        });
      };

      const addSection = () => {
        if (newSection.name && newSection.length && newSection.width) {
          setSections([...sections, {
            ...newSection,
            length: parseFloat(newSection.length),
            width: parseFloat(newSection.width)
          }]);
          setNewSection({
            name: '',
            length: '',
            width: '',
            type: '4" Backsplash',
            jointStatus: 'Standalone',
            group: ''
          });
        }
      };

      const removeSection = (index) => {
        setSections(sections.filter((_, i) => i !== index));
      };

      const updateSection = (index, field, value) => {
        const updated = [...sections];
        updated[index] = { ...updated[index], [field]: value };
        setSections(updated);
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white p-6">
          <div className="max-w-7xl mx-auto">
            <h1 className="text-4xl font-bold text-center mb-8 bg-gradient-to-r from-emerald-400 to-cyan-400 bg-clip-text text-transparent">
              Stone Prefab Calculator
            </h1>

            <div className="bg-gray-800/50 backdrop-blur rounded-xl p-6 mb-6 border border-gray-700">
              <h2 className="text-xl font-semibold mb-4">Project Configuration</h2>
              
              <div className="grid md:grid-cols-3 gap-4 mb-6">
                <div>
                  <label className="block text-sm mb-2 text-gray-300">Material Type</label>
                  <select 
                    value={materialType}
                    onChange={(e) => setMaterialType(e.target.value)}
                    className="w-full bg-gray-700 text-white rounded px-3 py-2 border border-gray-600"
                  >
                    <option value="Granite">Granite</option>
                    <option value="Marble">Marble</option>
                    <option value="Quartzite">Quartzite</option>
                    <option value="Quartz">Quartz</option>
                  </select>
                </div>
                
                <div>
                  <label className="block text-sm mb-2 text-gray-300">Stone Color</label>
                  <select 
                    value={stoneColor}
                    onChange={(e) => setStoneColor(e.target.value)}
                    className="w-full bg-gray-700 text-white rounded px-3 py-2 border border-gray-600"
                  >
                    <option value="Luna Grey">Luna Grey</option>
                    <option value="Carrara White">Carrara White</option>
                    <option value="Absolute Black">Absolute Black</option>
                    <option value="Calacatta Gold">Calacatta Gold</option>
                    <option value="Emperador Brown">Emperador Brown</option>
                    <option value="Super White">Super White</option>
                  </select>
                </div>
                
                <div>
                  <label className="block text-sm mb-2 text-gray-300">Edge Type</label>
                  <select 
                    value={edgeType}
                    onChange={(e) => setEdgeType(e.target.value)}
                    className="w-full bg-gray-700 text-white rounded px-3 py-2 border border-gray-600"
                  >
                    <option value="Basic Edge ($14/sq ft)">Basic Edge ($14/sq ft)</option>
                    <option value="Beveled Edge ($18/sq ft)">Beveled Edge ($18/sq ft)</option>
                    <option value="Ogee Edge ($22/sq ft)">Ogee Edge ($22/sq ft)</option>
                  </select>
                </div>
              </div>

              <div className="grid md:grid-cols-2 gap-6">
                <div className="border border-blue-500/30 rounded-lg p-4">
                  <h3 className="text-blue-400 font-semibold mb-3">Kitchen Sinks</h3>
                  <div className="mb-3">
                    <label className="block text-sm mb-2">Kitchen Sink Type</label>
                    <select 
                      value={kitchenSinkType}
                      onChange={(e) => setKitchenSinkType(e.target.value)}
                      className="w-full bg-gray-700 rounded px-3 py-2 border border-gray-600 text-white"
                    >
                      <option value="No Kitchen Sink ($0)">No Kitchen Sink ($0)</option>
                      <option value="Free Kitchen Sink ($180)">Free Kitchen Sink ($180)</option>
                      <option value="Premium Sink ($280)">Premium Sink ($280)</option>
                    </select>
                  </div>
                  <div>
                    <label className="block text-sm mb-2">Kitchen Sink Quantity</label>
                    <input 
                      type="number"
                      value={kitchenSinkQty}
                      onChange={(e) => setKitchenSinkQty(parseInt(e.target.value) || 0)}
                      className="w-full bg-gray-700 rounded px-3 py-2 border border-gray-600 text-white"
                    />
                  </div>
                </div>

                <div className="border border-purple-500/30 rounded-lg p-4">
                  <h3 className="text-purple-400 font-semibold mb-3">Bathroom Sinks</h3>
                  <div>
                    <label className="block text-sm mb-2">Bathroom Sink Quantity</label>
                    <input 
                      type="number"
                      value={bathroomSinkQty}
                      onChange={(e) => setBathroomSinkQty(parseInt(e.target.value) || 0)}
                      className="w-full bg-gray-700 rounded px-3 py-2 border border-gray-600 text-white"
                    />
                    <p className="text-xs text-gray-400 mt-1">$80 per bathroom sink</p>
                  </div>
                </div>
              </div>
            </div>

            <div className="text-center mb-6">
              <button 
                onClick={calculateResults}
                className="bg-gradient-to-r from-emerald-600 to-cyan-600 hover:from-emerald-700 hover:to-cyan-700 text-white font-bold py-4 px-12 rounded-xl text-lg shadow-lg transition"
              >
                Calculate Stone Requirements
              </button>
            </div>

            {calculatedResults && (
              <div className="bg-gray-800/50 backdrop-blur rounded-xl p-6 mb-6 border border-gray-700">
                <h2 className="text-xl font-semibold mb-4">Results</h2>
                
                <div className="bg-gradient-to-r from-emerald-600/20 to-cyan-600/20 border-2 border-emerald-500 rounded-xl p-6 text-center mb-6">
                  <div className="text-lg mb-2">Project Total:</div>
                  <div className="text-5xl font-bold text-emerald-400">
                    ${calculatedResults.projectTotal.toFixed(2)}
                  </div>
                </div>

                <div className="mb-6">
                  <h3 className="font-semibold text-lg mb-3 text-emerald-400">Stone Pieces Required</h3>
                  <div className="bg-gray-900/50 rounded-lg p-4">
                    <div className="grid md:grid-cols-2 gap-6">
                      <div>
                        <div className="text-sm text-gray-400 mb-2">Suggested Pieces:</div>
                        <div className="space-y-1">
                          {Object.keys(calculatedResults.stoneCounts).map((size, idx) => (
                            <div key={idx} className="text-lg">
                              {calculatedResults.stoneCounts[size]}× {size}
                            </div>
                          ))}
                        </div>
                      </div>
                      
                      <div>
                        <div className="text-sm text-gray-400 mb-2">Leftovers:</div>
                        <div className="space-y-1">
                          {calculatedResults.stoneOptimization.map((stone, idx) => (
                            <div key={idx} className="text-lg">
                              {stone.leftover}
                            </div>
                          ))}
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            )}
          </div>
        </div>
      );
    }

    ReactDOM.render(<StoneCalculator />, document.getElementById('root'));
  </script>
</body>
</html>
